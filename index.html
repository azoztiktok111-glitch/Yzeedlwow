<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Cairo', sans-serif;
  background: radial-gradient(circle at top, #0f172a, #020617);
  color: #fff;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  padding-bottom: 80px;
}

.app {
  width: 100%;
  max-width: 420px;
  padding: 20px;
  text-align: center;
}

h1, h2 { margin-bottom: 5px; }
.subtitle { color: #9ca3af; margin-bottom: 20px; }

.card {
  background: rgba(17, 24, 39, 0.85);
  border-radius: 18px;
  padding: 18px;
  backdrop-filter: blur(12px);
  box-shadow: 0 20px 40px rgba(0,0,0,.35);
  margin-bottom: 15px;
}

.row {
  display: flex;
  justify-content: space-between;
  padding: 10px 0;
  border-bottom: 1px solid #1f2937;
}

.row:last-child { border-bottom: none; }

.time { color: #38bdf8; font-weight: 700; }

#countdown { font-size: 0.95rem; color: #facc15; margin-top: 10px; }

button {
  background: #38bdf8;
  color: #020617;
  border: none;
  border-radius: 12px;
  padding: 12px;
  width: 100%;
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  margin-top: 10px;
}

input[type="text"] {
  padding: 8px;
  border-radius: 8px;
  border: none;
  width: 80%;
  margin-top: 10px;
}

.small-text { margin-top: 10px; font-size: 0.85rem; color: #9ca3af; }

/* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ */
.bottom-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  max-width: 420px;
  height: 60px;
  background: rgba(17,24,39,0.95);
  backdrop-filter: blur(12px);
  display: flex;
  justify-content: space-around;
  align-items: center;
  box-shadow: 0 -5px 15px rgba(0,0,0,0.3);
  z-index: 100;
  border-top-left-radius: 18px;
  border-top-right-radius: 18px;
}

.bottom-bar button {
  background: none;
  border: none;
  color: #9ca3af;
  font-size: 0.9rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
}

.bottom-bar button.active, .bottom-bar button:hover { color: #38bdf8; }

.bottom-bar button i {
  font-size: 1.4rem;
  margin-bottom: 2px;
}

.option-card {
  background: rgba(17, 24, 39, 0.95);
  border-radius: 18px;
  padding: 15px;
  margin-top: 10px;
  text-align: center;
  display: none;
  backdrop-filter: blur(12px);
  box-shadow: 0 15px 30px rgba(0,0,0,0.35);
}
</style>
</head>
<body>

<div class="app">

<!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<div id="homePage" class="option-card" style="display:block;">
  <h2>ğŸ•Œ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</h2>
  <div id="prayers"></div>
  <div class="card" id="countdownCard">
    <div id="countdown">Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©â€¦</div>
  </div>
</div>

<!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<div id="countersCard" class="option-card">
  <h2>ğŸ“Š Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
  <div id="cityName" class="small-text">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ...</div>
  <div id="localTime" class="small-text">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ù„ÙŠ: ...</div>

  <button onclick="enableNotifications()">ğŸ”” ØªÙØ¹ÙŠÙ„ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø£Ø°Ø§Ù†</button>

  <p style="margin-top:15px;">ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¯ÙŠÙ†Ø© Ø£Ø®Ø±Ù‰</p>
  <input type="text" id="cityInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
  <button onclick="searchLocation()">ğŸ” Ø¨Ø­Ø«</button>

  <!-- Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© -->
  <div id="dailyCounters" style="margin-top:15px;"></div>
</div>

<!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ -->
<div class="bottom-bar">
  <button onclick="showOption('homePage')"><i class="fas fa-home"></i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  <button onclick="showOption('countersCard')"><i class="fas fa-chart-bar"></i>Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</div>

<!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

<script>
let prayerTimes=null;
let nextPrayer=null;
let userLat=null;
let userLng=null;
let cityName='...';

function formatArabicTime(time24){
  let [h,m]=time24.split(":").map(Number);
  h=h%12||12;
  return `${h}:${m.toString().padStart(2,"0")}`;
}

function seconds(t){
  const [h,m]=t.split(":").map(Number);
  return h*3600 + m*60;
}

function getNextPrayer(times){
  const now=new Date();
  const nowSec = now.getHours()*3600 + now.getMinutes()*60;
  const list = [["Ø§Ù„ÙØ¬Ø±", times.Fajr], ["Ø§Ù„Ø¸Ù‡Ø±", times.Dhuhr], ["Ø§Ù„Ø¹ØµØ±", times.Asr], ["Ø§Ù„Ù…ØºØ±Ø¨", times.Maghrib], ["Ø§Ù„Ø¹Ø´Ø§Ø¡", times.Isha]];
  for(let p of list){ if(seconds(p[1])>nowSec) return p; }
  return ["Ø§Ù„ÙØ¬Ø±", times.Fajr];
}

function startCountdown(name,time){
  setInterval(()=>{
    const now = new Date();
    const [h,m]=time.split(":").map(Number);
    const target = new Date();
    target.setHours(h,m,0);
    if(target<now) target.setDate(target.getDate()+1);
    const diff=Math.floor((target-now)/1000);
    const hh=Math.floor(diff/3600);
    const mm=Math.floor((diff%3600)/60);
    const ss=diff%60;
    document.getElementById("countdown").innerText=`Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${name} Ø¨Ø¹Ø¯ ${hh}:${mm.toString().padStart(2,"0")}:${ss.toString().padStart(2,"0")}`;
    if(diff===0 && Notification.permission==="granted"){
      new Notification("ğŸ•Œ Ø­Ø§Ù† Ø§Ù„Ø¢Ù† ÙˆÙ‚Øª ØµÙ„Ø§Ø© "+name);
    }
  },1000);
}

function render(times){
  prayerTimes=times;
  const prayers=[["Ø§Ù„ÙØ¬Ø±", times.Fajr], ["Ø§Ù„Ø´Ø±ÙˆÙ‚", times.Sunrise], ["Ø§Ù„Ø¸Ù‡Ø±", times.Dhuhr], ["Ø§Ù„Ø¹ØµØ±", times.Asr], ["Ø§Ù„Ù…ØºØ±Ø¨", times.Maghrib], ["Ø§Ù„Ø¹Ø´Ø§Ø¡", times.Isha]];
  const box=document.getElementById("prayers");
  box.innerHTML="";
  prayers.forEach(p=>{
    box.innerHTML+=`<div class="row"><span>${p[0]}</span><span class="time">${formatArabicTime(p[1])}</span></div>`;
  });
  document.getElementById("prayers").style.display="block";
  document.getElementById("countdownCard").style.display="block";
  nextPrayer=getNextPrayer(times);
  startCountdown(nextPrayer[0],nextPrayer[1]);

  // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙÙŠ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
  document.getElementById("cityName").innerText = "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: " + cityName;
  updateLocalTime();
  updateDailyCounters();
}

function updateLocalTime(){
  const now = new Date();
  document.getElementById("localTime").innerText = "Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ù„ÙŠ: " + now.toLocaleTimeString();
  setTimeout(updateLocalTime,1000);
}

// Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
function updateDailyCounters(){
  if(!prayerTimes) return;
  const now = new Date();
  let passed=0;
  const prayersList=[prayerTimes.Fajr, prayerTimes.Dhuhr, prayerTimes.Asr, prayerTimes.Maghrib, prayerTimes.Isha];
  prayersList.forEach(t=>{
    const [h,m]=t.split(":").map(Number);
    const date=new Date();
    date.setHours(h,m,0);
    if(now>=date) passed++;
  });
  const remaining = 5 - passed;
  document.getElementById("dailyCounters").innerText = `Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©: ${passed} | Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${remaining}`;
}

// ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
function requestLocation(){
  navigator.geolocation.getCurrentPosition(pos=>{
    userLat=pos.coords.latitude;
    userLng=pos.coords.longitude;
    fetch(`https://api.aladhan.com/v1/timings?latitude=${userLat}&longitude=${userLng}&method=4`)
      .then(r=>r.json())
      .then(d=>{
        cityName=d.data.meta.timezone || 'Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ';
        render(d.data.timings);
      });
  },err=>{
    alert("ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø¹Ø±Ø¶ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ø¨Ø¯Ù‚Ø© ğŸ“");
  });
}

// ØªÙØ¹ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø°Ø§Ù†
function enableNotifications(){
  Notification.requestPermission().then(p=>{
    if(p==="granted"){ alert("ØªÙ… ØªÙØ¹ÙŠÙ„ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø£Ø°Ø§Ù† ğŸ””"); }
  });
}

// Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¯ÙŠÙ†Ø©
function searchLocation(){
  const city=document.getElementById("cityInput").value;
  if(!city) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©");
  fetch(`https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(city)}&country=&method=4`)
    .then(r=>r.json())
    .then(data=>{
      if(data.code!==200) return alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©");
      cityName=city;
      render(data.data.timings);
    })
    .catch(err=>{
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©");
      console.error(err);
    });
}

function showOption(cardId){
  document.getElementById("homePage").style.display = "none";
  document.getElementById("countersCard").style.display = "none";
  document.getElementById(cardId).style.display = "block";
}

window.onload=requestLocation;
</script>
</body>
</html>
