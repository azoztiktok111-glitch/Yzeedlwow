<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© + ØªØ³Ø¨ÙŠØ­ ÙˆØ£Ø°ÙƒØ§Ø±</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root { --bg-main: radial-gradient(circle at top, #0b1d2a, #000 60%); --accent: #4aa3ff; }
* { box-sizing: border-box; font-family: "IBM Plex Sans Arabic", system-ui; }
body { margin:0; min-height:100vh; background: var(--bg-main); color:#fff; transition: background 1s ease; }

/* Header */
.header { position: fixed; top:0; width:100%; height:65px; padding:8px 14px; display:flex; justify-content:space-between; align-items:center; background: rgba(0,0,0,.55); backdrop-filter: blur(12px); z-index:10; }
.settings-btn { width:36px;height:36px;border-radius:50%;background:rgba(74,163,255,.15); display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .3s ease; }
.settings-btn:hover { transform: scale(1.1); }
.settings-btn svg { width:18px;height:18px; fill: var(--accent); transition:fill .5s ease; }
.date-box { text-align:right; } 
.date-box .gregorian { font-size:11px; opacity:.6; } 
.date-box .hijri { font-size:14px; font-weight:500; }

/* Ø§Ù„ØµÙØ­Ø§Øª */
.content-page { display:none; padding:80px 16px 60px 16px; }
.content-page.active { display:block; }

.card { background: rgba(255,255,255,0.06); backdrop-filter: blur(16px); border-radius:16px; padding:18px; box-shadow:0 20px 40px rgba(0,0,0,.5); }
h1 { text-align:center; margin-top:0; font-weight:600; font-size:20px; }
.city { text-align:center; opacity:.6; margin-bottom:16px; font-size:13px; }
.time { background: rgba(255,255,255,0.08); border-radius:10px; padding:10px 14px; display:flex; justify-content:space-between; margin-bottom:8px; font-size:13px; }

/* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© */
.nextPrayerCard { text-align:center; background: rgba(0,0,0,.35); border-radius:16px; padding:16px; margin-bottom:16px; }
#nextPrayerLabel { font-size:14px; opacity:.8; }
#nextPrayerName { font-size:18px; color: var(--accent); margin:8px 0; font-weight:600; }
#nextPrayerCountdown { font-size:20px; font-weight:bold; color:#fff; }

/* Ø´Ø±ÙŠØ· Ø³ÙÙ„ÙŠ */
.bottom-nav { position:fixed; bottom:0; width:100%; height:55px; display:flex; justify-content:space-around; align-items:center; background:rgba(0,0,0,.55); backdrop-filter:blur(12px); z-index:20; }
.bottom-nav button { background:none; border:none; color:#fff; font-size:18px; cursor:pointer; display:flex; flex-direction:column; align-items:center; }
.bottom-nav button.active { color: var(--accent); }

/* ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¨ÙŠØ­ */
.tasbih { display:flex; flex-direction:column; align-items:center; margin-top:20px; }
.tasbih .count { font-size:28px; margin-bottom:10px; color: var(--accent); font-weight:600; }
.tasbih button { background: var(--accent); color:#fff; border:none; border-radius:50%; padding:14px 20px; margin:5px; cursor:pointer; font-size:16px; }

/* ØµÙØ­Ø© Ø§Ù„Ø£Ø°ÙƒØ§Ø± */
.adhkarText { white-space:normal; font-size:14px; color:#fff; line-height:1.6; margin-top:10px; }

/* Modal Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
.modal { position: fixed; inset:0; background:rgba(0,0,0,.7); opacity:0; pointer-events:none; display:flex; justify-content:center; align-items:center; transition:opacity .35s ease; z-index:30; }
.modal.show { opacity:1; pointer-events:auto; }
.modal-content { background:#0c1620; width:90%; max-width:320px; border-radius:18px; padding:18px; transform:translateY(-20px); transition: transform .4s ease; }
.modal.show .modal-content { transform:translateY(0); }
.modal-content h3 { text-align:center; margin:0; font-weight:600; font-size:16px; }
.version, .label { text-align:center; font-size:11px; color:#888; margin-top:4px; }
.value { text-align:center; font-size:13px; margin-bottom:12px; }
.toggle { display:flex; justify-content:space-between; align-items:center; background: rgba(255,255,255,.05); border-radius:10px; padding:10px 12px; margin-top:10px; font-size:12px; }
.toggle input { width:36px; height:18px; cursor:pointer; }
</style>
</head>
<body>

<div class="header">
  <div class="settings-btn" onclick="openSettings()">
    <svg viewBox="0 0 24 24"><path d="M19.14,12.94a7.43,7.43,0,0,0,.05-.94,7.43,7.43,0,0,0-.05-.94l2.11-1.65a.5.5,0,0,0,.12-.63l-2-3.46a.5.5,0,0,0-.6-.22l-2.49,1a7.28,7.28,0,0,0-1.63-.94l-.38-2.65A.5.5,0,0,0,11.78,2H8.22a.5.5,0,0,0-.49.41L7.35,5.06a7.28,7.28,0,0,0-1.63.94l-2.49-1a.5.5,0,0,0-.6.22l-2,3.46a.5.5,0,0,0,.12.63L2.86,11.06a7.43,7.43,0,0,0-.05.94,7.43,7.43,0,0,0,.05.94L0.75,14.59a.5.5,0,0,0-.12.63l2,3.46a.5.5,0,0,0,.6.22l2.49-1a7.28,7.28,0,0,0,1.63.94l.38,2.65a.5.5,0,0,0,.49.41h3.56a.5.5,0,0,0,.49-.41l.38-2.65a7.28,7.28,0,0,0,1.63-.94l2.49,1a.5.5,0,0,0,.6-.22l2-3.46a.5.5,0,0,0-.12-.63ZM10,15.5A3.5,3.5,0,1,1,13.5,12,3.5,3.5,0,0,1,10,15.5Z"/></svg>
  </div>
  <div class="date-box">
    <div class="gregorian" id="gregorian">--</div>
    <div class="hijri" id="hijri">--</div>
  </div>
</div>

<!-- Ø§Ù„ØµÙØ­Ø§Øª -->
<div class="content-page active" id="homePage">
  <div class="nextPrayerCard">
    <div id="nextPrayerLabel">Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© :</div>
    <div id="nextPrayerName">--</div>
    <div id="nextPrayerCountdown">--:--:--</div>
  </div>
  <div class="card" id="prayerTimesCard">
    <h1>ğŸ•Œ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</h1>
    <div class="city" id="city">Ø¬Ø§Ø±Ù ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...</div>
    <div id="times"></div>
  </div>
</div>

<div class="content-page" id="tasbihPage">
  <h2>Ø§Ù„ØªØ³Ø¨ÙŠØ­</h2>
  <div class="tasbih">
    <div class="count" id="tasbihCount">0</div>
    <button id="tasbihBtn">ØªØ³Ø¨ÙŠØ­</button>
    <button id="resetTasbih">Ø¥Ø¹Ø§Ø¯Ø©</button>
  </div>
</div>

<div class="content-page" id="adhkarPage">
  <h2>Ø§Ù„Ø£Ø°ÙƒØ§Ø±</h2>
  <div class="adhkarText" id="adhkarText">
    Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø­Ù…Ø¯Ù‡ Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ… Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡ ÙˆØ§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø± Ù„Ø§ Ø­ÙˆÙ„ ÙˆÙ„Ø§ Ù‚ÙˆØ© Ø¥Ù„Ø§ Ø¨Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ù„ÙŠ Ø§Ù„Ø¹Ø¸ÙŠÙ…...
  </div>
</div>

<div class="bottom-nav">
  <button onclick="showPage('homePage')" id="navHome">Ø§Ù„ØµÙ„Ø§Ø©</button>
  <button onclick="showPage('tasbihPage')" id="navTasbih">Ø§Ù„ØªØ³Ø¨ÙŠØ­</button>
  <button onclick="showPage('adhkarPage')" id="navAdhkar">Ø§Ù„Ø£Ø°ÙƒØ§Ø±</button>
</div>

<div class="modal" id="settings">
  <div class="modal-content">
    <h3>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
    <div class="version">v1.5.1</div>
    <div class="toggle">
      <span>ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª 24 Ø³Ø§Ø¹Ø©</span>
      <input type="checkbox" id="timeFormat" onchange="toggleTime()">
    </div>
    <div class="toggle">
      <span>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
      <input type="checkbox" id="notifToggle">
    </div>
    <div class="close" onclick="closeSettings()">Ø¥ØºÙ„Ø§Ù‚</div>
  </div>
</div>

<script>
// ØµÙˆØª Ø§Ù„Ø¶ØºØ·
const openSound = new Audio("https://www.myinstants.com/media/sounds/click.mp3");

// Ø£Ù„ÙˆØ§Ù† Ø§Ù„ØµÙ„ÙˆØ§Øª
const prayerThemes = {
  Fajr: { bg:"radial-gradient(circle at top, #1c3b57, #000 65%)", accent:"#7fc8ff" },
  Dhuhr: { bg:"radial-gradient(circle at top, #1a2e3f, #000 65%)", accent:"#4aa3ff" },
  Asr: { bg:"radial-gradient(circle at top, #202a33, #000 65%)", accent:"#5fa8d3" },
  Maghrib: { bg:"radial-gradient(circle at top, #2a1f3d, #000 65%)", accent:"#b58cff" },
  Isha: { bg:"radial-gradient(circle at top, #0b1320, #000 70%)", accent:"#3b82f6" }
};

// 12/24 Ø³Ø§Ø¹Ø©
let is24h = localStorage.getItem("timeFormat")==="24";
function formatTime(time){ let [h,m]=time.split(":").map(Number); if(is24h) return `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`; const period=h>=12?"Ù…":"Øµ"; h=h%12||12; return `${h}:${m.toString().padStart(2,"0")} ${period}`; }
function toggleTime(){ is24h=document.getElementById("timeFormat").checked; localStorage.setItem("timeFormat",is24h?"24":"12"); document.querySelectorAll(".ptime").forEach(el=>{ el.innerText=formatTime(el.dataset.time); }); }

// Ø§Ù„ØµÙØ­Ø§Øª
function showPage(id){ document.querySelectorAll(".content-page").forEach(p=>p.classList.remove("active")); document.getElementById(id).classList.add("active"); document.querySelectorAll(".bottom-nav button").forEach(b=>b.classList.remove("active")); document.querySelector(`#nav${id.charAt(0).toUpperCase()+id.slice(1)}`).classList.add("active"); }

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
const settings=document.getElementById("settings");
function openSettings(){ openSound.play(); settings.classList.add("show"); }
function closeSettings(){ settings.classList.remove("show"); }

// ØªØ­Ù…ÙŠÙ„
document.addEventListener("DOMContentLoaded",()=>{ document.getElementById("timeFormat").checked=is24h; });

// ØªØ³Ø¨ÙŠØ­
let tasbihCount = parseInt(localStorage.getItem("tasbihCount")) || 0;
const tasbihDisplay = document.getElementById("tasbihCount");
tasbihDisplay.innerText = tasbihCount;
document.getElementById("tasbihBtn").addEventListener("click", () => { tasbihCount++; tasbihDisplay.innerText = tasbihCount; localStorage.setItem("tasbihCount", tasbihCount); });
document.getElementById("resetTasbih").addEventListener("click", () => { tasbihCount = 0; tasbihDisplay.innerText = tasbihCount; localStorage.setItem("tasbihCount", tasbihCount); });

// Ø§Ù„Ø£Ø°ÙƒØ§Ø±
const adhkarList = [ "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø­Ù…Ø¯Ù‡ Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ… Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡ ÙˆØ§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±...", "Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ… Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡ ÙˆØ£ØªÙˆØ¨ Ø¥Ù„ÙŠÙ‡ Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ ÙˆØ§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ ÙˆØ§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±" ];
let currentAdhkar = 0;
const adhkarText = document.getElementById("adhkarText");
setInterval(()=>{ currentAdhkar = (currentAdhkar+1)%adhkarList.length; adhkarText.innerText = adhkarList[currentAdhkar]; },15000);

// ====== Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ ======
function getNextPrayer(prayerTimes){ const now=new Date(); for(let p in prayerTimes){ if(p==="Sunrise") continue; let [h,m]=prayerTimes[p].split(":").map(Number); let t=new Date(); t.setHours(h,m,0,0); if(now<t) return {name:p,time:t}; } let [h,m]=prayerTimes.Isha.split(":").map(Number); let t=new Date(); t.setHours(h,m,0,0); return {name:"Isha",time:t}; }

let nextTime = null;
function updateNextPrayerTime(prayerTimes){
  const now = new Date();
  const [fajrH,fajrM] = prayerTimes.Fajr.split(":").map(Number);
  const [sunH,sunM] = prayerTimes.Sunrise.split(":").map(Number);
  const fajrTime = new Date(); fajrTime.setHours(fajrH,fajrM,0,0);
  const sunriseTime = new Date(); sunriseTime.setHours(sunH,sunM,0,0);

  const labelEl = document.getElementById("nextPrayerLabel");
  const nameEl = document.getElementById("nextPrayerName");

  if(now >= fajrTime && now < sunriseTime){
    labelEl.innerText = "Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆÙ‚ :";
    nameEl.innerText = "";
    nextTime = sunriseTime;
  } else {
    labelEl.innerText = "Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© :";
    const next = getNextPrayer(prayerTimes);
    nameEl.innerText = {"Fajr":"Ø§Ù„ÙØ¬Ø±","Dhuhr":"Ø§Ù„Ø¸Ù‡Ø±","Asr":"Ø§Ù„Ø¹ØµØ±","Maghrib":"Ø§Ù„Ù…ØºØ±Ø¨","Isha":"Ø§Ù„Ø¹Ø´Ø§Ø¡"}[next.name];
    nextTime = next.time;
  }
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
setInterval(()=>{
  if(!nextTime) return;
  const now = new Date();
  let diff = nextTime - now;
  const countdownEl = document.getElementById("nextPrayerCountdown");
  if(diff <=0){ countdownEl.innerText = "Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©"; return; }
  const h = Math.floor(diff/1000/60/60);
  const m = Math.floor((diff/1000/60)%60);
  const s = Math.floor((diff/1000)%60);
  countdownEl.innerText = `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;
},1000);

// Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© + Ø§Ù„ØªØ§Ø±ÙŠØ®
navigator.geolocation.getCurrentPosition(pos=>{
  const {latitude,longitude}=pos.coords;
  fetch(`https://api.aladhan.com/v1/timings?latitude=${latitude}&longitude=${longitude}&method=4`)
    .then(r => r.json())
    .then(data => {
      const gregorian = data.data.date.gregorian;
      document.getElementById("gregorian").innerText = `${gregorian.weekday.en}, ${gregorian.day} ${gregorian.month.en} ${gregorian.year}`;
      const hijri = data.data.date.hijri;
      document.getElementById("hijri").innerText = `${hijri.day} ${hijri.month.ar} ${hijri.year}`;

      const times = data.data.timings;
      const c = document.getElementById("times");
      c.innerHTML="";
      const prayers={"Fajr":"Ø§Ù„ÙØ¬Ø±","Dhuhr":"Ø§Ù„Ø¸Ù‡Ø±","Asr":"Ø§Ù„Ø¹ØµØ±","Maghrib":"Ø§Ù„Ù…ØºØ±Ø¨","Isha":"Ø§Ù„Ø¹Ø´Ø§Ø¡"};
      for(let p in prayers){
        const t = times[p];
        c.innerHTML += `<div class="time"><span>${prayers[p]}</span><span class="ptime" data-time="${t}">${formatTime(t)}</span></div>`;
      }

      window.prayerTimesData = times;
      updateNextPrayerTime(times);
      setInterval(()=>updateNextPrayerTime(times),60000);
    });

  fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=ar`)
    .then(r=>r.json()).then(d=>{ document.getElementById("city").innerText=`${d.city||d.locality}, ${d.countryName}`; });
});

// Ø£Ù„ÙˆØ§Ù† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
setInterval(()=>{
  if(!window.prayerTimesData) return;
  let nextName = document.getElementById("nextPrayerName").innerText;
  let key = {"Ø§Ù„ÙØ¬Ø±":"Fajr","Ø§Ù„Ø¸Ù‡Ø±":"Dhuhr","Ø§Ù„Ø¹ØµØ±":"Asr","Ø§Ù„Ù…ØºØ±Ø¨":"Maghrib","Ø§Ù„Ø¹Ø´Ø§Ø¡":"Isha"}[nextName];
  if(key){ document.documentElement.style.setProperty("--bg-main",prayerThemes[key].bg); document.documentElement.style.setProperty("--accent",prayerThemes[key].accent); }
},5000);

// Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
document.getElementById("notifToggle").addEventListener("change", e => { if(e.target.checked){ Notification.requestPermission(); } });

</script>
</body>
</html>
